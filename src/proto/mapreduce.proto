syntax = "proto3";

package mapreduce;

service Master {
    rpc ProcessClientRequest (ClientRequest) returns (Response);
    rpc NotifyMapFinished (JobId) returns (Response);
    rpc NotifyReduceFinished (JobId) returns (Response);
}

service MapperListener {
    rpc ProcessMapRequest (MapRequest) returns (Response);
    rpc GetMapConfig (MapConfigRequest) returns (MapConfig);
}

service ReducerListener {
    rpc ProcessReduceRequest (stream ReduceRequest) returns (Response);
    rpc GetReduceConfig (ReduceConfigRequest) returns (stream ReduceConfig);
}

message ClientRequest {
    string input_filepath = 1;
    string output_filepath = 2;
    string mapper_execpath = 3;
    string reducer_execpath = 4;
    uint32 num_mappers = 5;
    uint32 num_reducers = 6;
}

// Should include only one execpath/output_filepath and multiple input_filepaths.
// Stream will contain redundant information (multiple execpaths/output_filepaths).
message ReduceRequest {
    uint64 id = 1;
    string input_filepath = 2;
    string execpath = 3;
    string output_filepath = 4; 
}

message MapRequest {
    uint64 id = 1;
    string filepath = 2;
    string execpath = 3;
    uint32 num_reducers = 4;
}

message MapConfigRequest {
    // Later probably id of map request or sth.
    string execpath = 1;
}

message ReduceConfigRequest {
    // Later probably id of map request or sth.
    string execpath = 1;
}

message MapConfig {
    uint64 id = 1;
    string filepath = 2;
    uint32 num_reducers = 3;
}

// Config should include only one output_filepath and multiple input_filepaths
// That means, (stream ReduceConfig) will contain redundant information (multiple output_filepaths).
// [TODO] Maybe find better solution.
message ReduceConfig {
    uint64 id = 1;
    string input_filepath = 2;
    string output_filepath = 3;
}

message JobId {
    uint64 id = 1;
}

message Response {
    string result = 1;
}